# ğŸµ é¥®è¿¹ (DrinkTrace) - æ™ºèƒ½é¥®å“è®°å½•åº”ç”¨

<p align="center">
  <img src="https://img.shields.io/badge/Flutter-3.10.8+-blue.svg" alt="Flutter Version">
  <img src="https://img.shields.io/badge/Dart-3.0+-blue.svg" alt="Dart Version">
  <img src="https://img.shields.io/badge/License-MIT-green.svg" alt="License">
  <img src="https://img.shields.io/badge/Platform-Android%20%7C%20iOS-lightgrey.svg" alt="Platform">
</p>

## ğŸ“± åº”ç”¨ç®€ä»‹

**é¥®è¿¹**æ˜¯ä¸€æ¬¾ä¸“ä¸ºé¥®å“çˆ±å¥½è€…æ‰“é€ çš„æ™ºèƒ½è®°å½•åº”ç”¨ï¼Œå¸®åŠ©ä½ è¿½è¸ªæ¯æ—¥çš„é¥®å“æ¶ˆè´¹ï¼Œè®°å½•æ¯ä¸€æ¯ç¾å¥½çš„å‘³é“ã€‚æ— è®ºæ˜¯æ¸…æ™¨çš„å’–å•¡ã€åˆåçš„å¥¶èŒ¶ï¼Œè¿˜æ˜¯å¤œæ™šçš„å°é…’ï¼Œé¥®è¿¹éƒ½èƒ½å¸®ä½ å®Œæ•´è®°å½•ã€‚

### âœ¨ æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| ğŸ“ **é¥®å“è®°å½•** | å¿«é€Ÿè®°å½•é¥®å“çš„åç§°ã€ç±»åˆ«ã€ä»·æ ¼ã€è¯„åˆ†ã€å¿ƒæƒ…å’Œå¤‡æ³¨ |
| ğŸ“Š **æ•°æ®ç»Ÿè®¡** | å¤šç»´åº¦ç»Ÿè®¡é¥®å“æ¶ˆè´¹æ•°æ®ï¼Œæ”¯æŒå‘¨/æœˆ/å…¨éƒ¨æ—¶é—´èŒƒå›´ |
| ğŸ“… **é¥®ç”¨æ—¥è®°** | è®°å½•æ¯æ—¥çš„é¥®å“ä½“éªŒå’Œå¿ƒæƒ…éšç¬” |
| ğŸ† **æˆå°±ç³»ç»Ÿ** | å®Œæˆå„ç§é¥®å“æŒ‘æˆ˜ï¼Œè§£é”æˆå°±å¾½ç«  |
| ğŸŒ“ **æ·±è‰²æ¨¡å¼** | æ”¯æŒæµ…è‰²/æ·±è‰²ä¸»é¢˜åˆ‡æ¢ï¼ŒæŠ¤çœ¼èˆ’é€‚ |
| ğŸ“· **å›¾ç‰‡è®°å½•** | ä¸ºæ¯æ¯é¥®å“æ‹ç…§ç•™å¿µï¼Œæ”¯æŒå›¾ç‰‡å‹ç¼©å’Œç¼“å­˜ |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é¥®è¿¹æŠ€æœ¯æ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI å±‚                                                       â”‚
â”‚  â”œâ”€â”€ Flutter 3.10.8+ (è·¨å¹³å°UIæ¡†æ¶)                          â”‚
â”‚  â”œâ”€â”€ Material Design 3 (è®¾è®¡è¯­è¨€)                            â”‚
â”‚  â”œâ”€â”€ oc_liquid_glass (æ¶²æ€ç»ç’ƒæ•ˆæœç»„ä»¶)                       â”‚
â”‚  â””â”€â”€ Cached Network Image (å›¾ç‰‡ç¼“å­˜)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çŠ¶æ€ç®¡ç†å±‚                                                   â”‚
â”‚  â””â”€â”€ Signals 6.0 (å“åº”å¼çŠ¶æ€ç®¡ç†)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚                                                       â”‚
â”‚  â”œâ”€â”€ ObjectBox 4.0 (é«˜æ€§èƒ½æœ¬åœ°æ•°æ®åº“)                        â”‚
â”‚  â”œâ”€â”€ Dart Mappable (ä»£ç ç”Ÿæˆåºåˆ—åŒ–)                          â”‚
â”‚  â””â”€â”€ Shared Preferences (è½»é‡é…ç½®å­˜å‚¨)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç½‘ç»œå±‚                                                       â”‚
â”‚  â””â”€â”€ Dio 5.7 (HTTPå®¢æˆ·ç«¯)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è·¯ç”±å±‚                                                       â”‚
â”‚  â””â”€â”€ Go Router 14.6 (Navigator 2.0 è·¯ç”±)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€§èƒ½ä¼˜åŒ–å±‚                                                   â”‚
â”‚  â”œâ”€â”€ Isolate Pool (çº¿ç¨‹æ± ç®¡ç†)                               â”‚
â”‚  â”œâ”€â”€ Isolate.run() (å¼‚æ­¥è®¡ç®—)                                â”‚
â”‚  â””â”€â”€ RepaintBoundary (æ¸²æŸ“ä¼˜åŒ–)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ€§èƒ½ä¼˜åŒ–äº®ç‚¹

é¥®è¿¹åœ¨æ€§èƒ½ä¼˜åŒ–æ–¹é¢åšäº†å¤§é‡å·¥ä½œï¼Œç¡®ä¿åº”ç”¨æµç•…è¿è¡Œï¼š

#### 1. Isolate å¹¶è¡Œè®¡ç®—

```dart
// JSON åºåˆ—åŒ–ä½¿ç”¨ Isolate
static Future<String> encodeJsonIsolate(Map<String, dynamic> data) async {
  return await Isolate.run(() => jsonEncode(data));
}

// ç»Ÿè®¡è®¡ç®—ä½¿ç”¨ Isolate
final stats = await Isolate.run(() => _calculateStats(records));

// å›¾ç‰‡å‹ç¼©ä½¿ç”¨ Isolate
static Future<Uint8List> compressImage({...}) async {
  return await Isolate.run(() => _compressImageSync(...));
}
```

#### 2. å…¨å±€çº¿ç¨‹æ± ç®¡ç†

```dart
// åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–çº¿ç¨‹æ± 
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await globalIsolatePool.init(); // âœ… åˆå§‹åŒ–å…¨å±€çº¿ç¨‹æ± 
  runApp(const MyApp());
}
```

#### 3. å›¾ç‰‡å­˜åœ¨æ€§ç¼“å­˜

```dart
// æ‰¹é‡é¢„åŠ è½½å›¾ç‰‡å­˜åœ¨æ€§æ£€æŸ¥ï¼Œé¿å…é‡å¤IO
Future<void> _preloadImageExistence() async {
  final paths = _recentRecords.value
      .where((r) => r.imagePath != null)
      .map((r) => r.imagePath!)
      .toList();
  
  final results = await FileChecker.checkMultipleFiles(paths);
  _imageExistenceCache.addAll(results);
}
```

#### 4. å“åº”å¼çŠ¶æ€ç®¡ç†

ä½¿ç”¨ Signals å®ç°é«˜æ•ˆçš„å“åº”å¼æ›´æ–°ï¼š

```dart
// å®šä¹‰ä¿¡å·
final Signal<List<DrinkRecord>> _todayRecords = signal([]);
final Signal<int> teaCount = signal(0);

// è‡ªåŠ¨ç›‘å¬æ›´æ–°
effect(() {
  dataRefreshSignal.value; // è¯»å–ä¿¡å·å€¼ä»¥å»ºç«‹ä¾èµ–
  if (_isInitialized) {
    _updateRecords();
  }
});
```

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
lib/
â”œâ”€â”€ main.dart                      # åº”ç”¨å…¥å£
â”œâ”€â”€ router/
â”‚   â””â”€â”€ app_router.dart            # Go Router è·¯ç”±é…ç½®
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ home_screen.dart           # é¦–é¡µ - ä»Šæ—¥è®°å½•
â”‚   â”œâ”€â”€ stats_screen.dart          # ç»Ÿè®¡é¡µ - æ•°æ®åˆ†æ
â”‚   â”œâ”€â”€ diary_screen.dart          # æ—¥è®°é¡µ - å¿ƒæƒ…è®°å½•
â”‚   â”œâ”€â”€ profile_screen.dart        # ä¸ªäººä¸­å¿ƒ
â”‚   â””â”€â”€ achievement_screen.dart    # æˆå°±ç³»ç»Ÿ
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ drink_record.dart          # é¥®å“è®°å½•æ¨¡å‹
â”‚   â”œâ”€â”€ drink_stats.dart           # ç»Ÿè®¡æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ diary_entry.dart           # æ—¥è®°æ¡ç›®æ¨¡å‹
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ objectbox_service.dart     # ObjectBox æ•°æ®åº“æœåŠ¡
â”‚   â””â”€â”€ ai_service.dart            # AI åˆ†ææœåŠ¡
â”œâ”€â”€ widgets/
â”‚   â”œâ”€â”€ drink_card.dart            # é¥®å“å¡ç‰‡ç»„ä»¶
â”‚   â”œâ”€â”€ add_drink_dialog.dart      # æ·»åŠ é¥®å“å¼¹çª—
â”‚   â””â”€â”€ add_diary_dialog.dart      # æ·»åŠ æ—¥è®°å¼¹çª—
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ app_theme.dart             # ä¸»é¢˜é…ç½®
â”‚   â”œâ”€â”€ performance_utils.dart     # æ€§èƒ½ä¼˜åŒ–å·¥å…·
â”‚   â”œâ”€â”€ isolate_pool.dart          # çº¿ç¨‹æ± ç®¡ç†
â”‚   â””â”€â”€ file_checker.dart          # æ–‡ä»¶æ£€æŸ¥å·¥å…·
â””â”€â”€ objectbox.g.dart               # ObjectBox ç”Ÿæˆçš„ä»£ç 
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. é¥®å“è®°å½•

æ”¯æŒè®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
- **åŸºç¡€ä¿¡æ¯**: åç§°ã€ç±»åˆ«ï¼ˆèŒ¶/é…’/å¥¶èŒ¶ï¼‰ã€è¡¨æƒ…ç¬¦å·
- **æ¶ˆè´¹ä¿¡æ¯**: ä»·æ ¼ã€å®¹é‡ã€é…’ç²¾åº¦æ•°
- **è¯„ä»·ä¿¡æ¯**: è¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼‰ã€å¿ƒæƒ…æ ‡ç­¾
- **å¤‡æ³¨**: æ–‡å­—æè¿°å’Œç…§ç‰‡

```dart
@Entity()
class DrinkRecord {
  int id;
  String name;           // é¥®å“åç§°
  String category;       // ç±»åˆ«: èŒ¶ã€é…’ã€å¥¶èŒ¶
  String emoji;          // è¡¨æƒ…ç¬¦å·
  double price;          // ä»·æ ¼
  int rating;            // è¯„åˆ† 1-5
  String mood;           // å¿ƒæƒ…
  String? comment;       // å¤‡æ³¨
  String? imagePath;     // å›¾ç‰‡è·¯å¾„
  double volume;         // å®¹é‡ ml
  double alcoholDegree;  // é…’ç²¾åº¦æ•°
  DateTime timestamp;    // æ—¶é—´æˆ³
}
```

### 2. æ•°æ®ç»Ÿè®¡

æä¾›å¤šç»´åº¦æ•°æ®åˆ†æï¼š

- **æ¶ˆè´¹ç»Ÿè®¡**: æ€»æ¶ˆè´¹é‡‘é¢ã€é¥®å“æ•°é‡
- **ç±»åˆ«åˆ†å¸ƒ**: èŒ¶/é…’/å¥¶èŒ¶çš„æ¶ˆè´¹å æ¯”
- **æ—¶é—´è¶‹åŠ¿**: å‘¨/æœˆ/å…¨éƒ¨æ—¶é—´èŒƒå›´çš„æ•°æ®è¶‹åŠ¿
- **çƒ­åŠ›å›¾**: å¯è§†åŒ–å±•ç¤ºæ¯æ—¥é¥®ç”¨é¢‘ç‡
- **è¿ç»­è®°å½•**: è®¡ç®—è¿ç»­é¥®ç”¨å¤©æ•°

### 3. é¥®ç”¨æ—¥è®°

ç‹¬ç«‹çš„æ—¥è®°åŠŸèƒ½ï¼Œè®°å½•æ¯æ—¥å¿ƒæƒ…ï¼š
- æ”¯æŒæ–‡å­—è®°å½•
- å¯å…³è”å½“æ—¥é¥®å“
- æ—¶é—´çº¿å±•ç¤º

### 4. æˆå°±ç³»ç»Ÿ

é€šè¿‡å®Œæˆå„ç§æŒ‘æˆ˜è§£é”æˆå°±ï¼š
- é¦–æ¬¡è®°å½•
- è¿ç»­è®°å½•å¤©æ•°
- æ¶ˆè´¹é‡‘é¢é‡Œç¨‹ç¢‘
- å“ç±»æ¢ç´¢è€…

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Flutter SDK 3.10.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- Dart SDK 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- Android Studio / Xcode (ç”¨äºæ¨¡æ‹Ÿå™¨)

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“**

```bash
git clone https://github.com/huangming774/DrinkTrace.git
cd DrinkTrace
```

2. **å®‰è£…ä¾èµ–**

```bash
flutter pub get
```

> å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥é…ç½®å›½å†…é•œåƒï¼š
> ```bash
> # Windows PowerShell
> $env:PUB_HOSTED_URL="https://pub.flutter-io.cn"
> $env:FLUTTER_STORAGE_BASE_URL="https://storage.flutter-io.cn"
> flutter pub get
> ```

3. **ç”Ÿæˆä»£ç **

é¡¹ç›®ä½¿ç”¨äº†ä»£ç ç”Ÿæˆå·¥å…·ï¼Œéœ€è¦è¿è¡Œ build_runnerï¼š

```bash
flutter pub run build_runner build --delete-conflicting-outputs
```

4. **è¿è¡Œåº”ç”¨**

```bash
# å¼€å‘æ¨¡å¼
flutter run

# å‘å¸ƒæ¨¡å¼
flutter run --release
```

### æ„å»ºå‘å¸ƒç‰ˆæœ¬

```bash
# Android APK
flutter build apk --release

# Android App Bundle
flutter build appbundle --release

# iOS
flutter build ios --release
```

---

## ğŸ¨ è®¾è®¡ç‰¹è‰²

### è§†è§‰è®¾è®¡

- **ä¸»è‰²è°ƒ**: ç±³ç™½è‰² (#F5F1E8) è¥é€ æ¸©é¦¨æ°›å›´
- **æ·±è‰²æ¨¡å¼**: æ·±ç° (#1A1A1A) æŠ¤çœ¼èˆ’é€‚
- **æ¶²æ€ç»ç’ƒæ•ˆæœ**: ä½¿ç”¨ oc_liquid_glass ç»„ä»¶å®ç°ç°ä»£æ„ŸUI
- **åœ†è§’è®¾è®¡**: ç»Ÿä¸€çš„åœ†è§’é£æ ¼ï¼ŒæŸ”å’Œäº²åˆ‡

### äº¤äº’è®¾è®¡

- **åº•éƒ¨å¯¼èˆª**: 4ä¸ªä¸»è¦åŠŸèƒ½å…¥å£ï¼Œæ“ä½œä¾¿æ·
- **æ‚¬æµ®æŒ‰é’®**: å¿«é€Ÿæ·»åŠ é¥®å“è®°å½•
- **æ‰‹åŠ¿æ“ä½œ**: æ»‘åŠ¨åˆ é™¤ã€ä¸‹æ‹‰åˆ·æ–°
- **åŠ¨ç”»è¿‡æ¸¡**: æµç•…çš„é¡µé¢åˆ‡æ¢åŠ¨ç”»

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-----|-------|-------|------|
| å¯åŠ¨æ—¶é—´ | ~3s | ~1.5s | 50% â†“ |
| åˆ—è¡¨æ»šåŠ¨å¸§ç‡ | 30-40fps | 55-60fps | 50% â†‘ |
| å¤§æ•°æ®åŠ è½½ | å¡é¡¿ | æµç•… | æ˜¾è‘—æ”¹å–„ |
| å†…å­˜å ç”¨ | è¾ƒé«˜ | ä¼˜åŒ– | 20% â†“ |

---

## ğŸ”§ å¼€å‘å·¥å…·

### ä»£ç ç”Ÿæˆ

é¡¹ç›®ä½¿ç”¨äº†ä»¥ä¸‹ä»£ç ç”Ÿæˆå·¥å…·ï¼Œä¿®æ”¹ç›¸å…³æ–‡ä»¶åéœ€è¦é‡æ–°ç”Ÿæˆï¼š

```bash
# ç”Ÿæˆæ‰€æœ‰ä»£ç 
flutter pub run build_runner build --delete-conflicting-outputs

# ç›‘è§†æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡æ–°ç”Ÿæˆï¼‰
flutter pub run build_runner watch
```

### ç”Ÿæˆçš„æ–‡ä»¶

- `objectbox.g.dart` - ObjectBox æ•°æ®åº“ä»£ç 
- `*.mapper.dart` - Dart Mappable åºåˆ—åŒ–ä»£ç 

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### æäº¤è§„èŒƒ

- ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯
- éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼
- ç¡®ä¿é€šè¿‡æ‰€æœ‰æµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸ™ è‡´è°¢

- [Flutter](https://flutter.dev/) - è·¨å¹³å°UIæ¡†æ¶
- [ObjectBox](https://objectbox.io/) - é«˜æ€§èƒ½æœ¬åœ°æ•°æ®åº“
- [Signals](https://dartsignals.dev/) - å“åº”å¼çŠ¶æ€ç®¡ç†
- [Go Router](https://pub.dev/packages/go_router) - å£°æ˜å¼è·¯ç”±

---

<p align="center">
  <strong>ğŸµ è®°å½•æ¯ä¸€æ¯ç¾å¥½ï¼Œå“å‘³ç”Ÿæ´»ç‚¹æ»´</strong>
</p>

<p align="center">
  Made with â¤ï¸ by DrinkTrace Team
</p>
